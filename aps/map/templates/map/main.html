{% load static %}
{% load leaflet_tags %}

<html lang="en">
<head>
    {% leaflet_js %}
    {% leaflet_css %}
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Moldova Map</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        #gis {
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- Favicon -->
    <link rel="icon" href="{% static 'img/icon/favicon.png' %}"/>

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Quicksand:wght@600;700&display=swap"
            rel="stylesheet"
    />


    <!-- Customized Bootstrap Stylesheet -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}"/>

    <!-- Template Stylesheet -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}"/>

    <link rel="stylesheet" type="text/css"
          href="{% static 'dist/leaflet.groupedlayercontrol.min.css' %}">
    <script type="application/javascript" src="{% static 'dist/leaflet.ajax.js' %}"></script>
    <script type="application/javascript"
            src="{% static 'dist/leaflet.groupedlayercontrol.min.js' %}"></script>

</head>
<body>


<script type="application/javascript">
    function our_layers(map, options) {

        var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        var OpenTopoMap = L.tileLayer('http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: 'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });

        function districtStyle(feature) {
            return {
                fillColor: "#afbbda",
                fillOpacity: 0,
                color: "#0048ff",
                weight: 2,
            };
        }

        function moldovaStyle(feature) {
            return {
                fillColor: "#afbbda",
                fillOpacity: 0,
                color: "orange",
                weight: 2,
            };
        }

        function arieStyle(feature) {
            return {
                fillColor: "#b8cba8",
                fillOpacity: 0.5,
                color: "#32793a",
                weight: 2,
            };
        }

        var locality = new L.GeoJSON.AJAX("{% url 'map:locality' %}", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng,
                    {
                        radius: 3,
                        fillColor: "#ff7800",
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    });
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name.toString());
            }

        });


        var moldova = new L.GeoJSON.AJAX("{% url 'map:country' %}",
            {style: moldovaStyle}
        );

        var district = new L.GeoJSON.AJAX("{% url 'map:district' %}",
            {
                style: districtStyle,
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name.toString());
                }
            }
        );

        var area = new L.GeoJSON.AJAX("{% url 'map:area' %}",
            {
                style: arieStyle,
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name.toString());
                }
            }
        );

        var area_point = new L.GeoJSON.AJAX("{% url 'map:area_point' %}",
            {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng,
                        {
                            radius: 3,
                            fillColor: "#32793a",
                            color: "#000",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                },
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.denumirea.toString());
                }
            }
        );

        var location = new L.GeoJSON.AJAX("{% url 'map:location' %}", {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name.toString());
            }
        });

        osm.addTo(map);
        moldova.addTo(map);
        area.addTo(map);

        var baseLayers = {
            "OpenStreetMap": osm,
            "OpenTopoMap": OpenTopoMap
        };

        var groupedOverlays = {
            "Administrativ": {
                "Border of Moldova": moldova,
                "Districts": district,
                "Localities": locality,
            },
            "APS": {
                "Protected Areas": area,
                "Protected Areas (points)": area_point,
            },
            "Other": {
                "Locations": location,
            }
        };
        L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);


        // L.Control.textbox = L.Control.extend({
        //     onAdd: function (map) {
        //         var text = L.DomUtil.create('div');
        //         text.id = "info_text";
        //         text.innerHTML = "<h1>Republic of Moldova: Protected Areas</h1>"
        //         return text;
        //     }
        // });
        // L.control.textbox = function (opts) {
        //     return new L.Control.textbox(opts);
        // }
        // L.control.textbox({position: 'bottomright'}).addTo(map);


    }


</script>

<!-- Navbar Start -->
<nav
        class="navbar navbar-expand-lg bg-white navbar-light sticky-top py-lg-0 px-4 px-lg-3 wow fadeIn"
        data-wow-delay="0.1s"
>
    <a href="#" class="navbar-brand p-0">
        <img class="img-fluid me-3" alt="Icon" src="{% static 'img/icon/icon.png' %}"/>
        <h2 class="m-0 text-primary">Republic of Moldova: Protected Areas</h2>
    </a>

    <div class="navbar-nav ms-auto">
        <a href="#" class="nav-item nav-link active">Home</a>
        <a href="#" class="nav-item nav-link">About</a>
    </div>
    <a href="#" class="nav-item nav-link">Contact</a>

</nav>
<!-- Navbar End -->


{% leaflet_map 'gis' callback="window.our_layers" %}
</body>
</html>